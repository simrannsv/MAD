<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAD - Multi-Agent Debate</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    #root {
      min-height: 100vh;
    }

    .app {
      display: flex;
      min-height: 100vh;
      background: #f8f9fc;
    }

    .sidebar {
      width: 300px;
      background: white;
      border-right: 1px solid #e5e7eb;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
    }

    .sidebar-header {
      padding: 32px 24px 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .sidebar-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .sidebar-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .agents-container {
      padding: 20px;
    }

    .agent-card {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 12px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 2px solid transparent;
      position: relative;
    }

    .agent-card:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .agent-card.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #4f46e5;
      transform: translateX(8px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .agent-card.speaking {
      animation: pulse 1.5s ease-in-out infinite;
      border-color: #10b981;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    @keyframes pulse {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(12px); }
    }

    .agent-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
      position: relative;
      z-index: 1;
    }

    .agent-card.active .agent-icon,
    .agent-card.speaking .agent-icon {
      background: white;
    }

    .agent-info {
      flex: 1;
      position: relative;
      z-index: 1;
    }

    .agent-info h3 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .agent-info p {
      font-size: 13px;
      opacity: 0.7;
    }

    .agent-status {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 12px;
      background: rgba(16, 185, 129, 0.2);
      color: #059669;
      font-weight: 600;
      margin-top: 4px;
      display: inline-block;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .header {
      background: white;
      padding: 20px 32px;
      border-bottom: 1px solid #e5e7eb;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 16px;
    }

    .breadcrumb {
      font-size: 15px;
      color: #6b7280;
      font-weight: 500;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .topic-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .topic-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
      min-width: 300px;
    }

    .topic-input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
    }

    .btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .content-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 24px;
      padding: 32px;
      overflow-y: auto;
      flex: 1;
    }

    .debate-section {
      background: white;
      border-radius: 20px;
      padding: 32px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      animation: fadeInUp 0.5s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .debate-title {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      line-height: 1.3;
    }

    .debate-subtitle {
      color: #6b7280;
      font-size: 16px;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #10b981;
      animation: blink 1.5s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .loading-container {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f4f6;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .rounds-container {
      margin-bottom: 32px;
    }

    .round-section {
      margin-bottom: 32px;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .round-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .round-number {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .round-title {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a2e;
    }

    .agent-response {
      display: flex;
      gap: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
      border-left: 4px solid transparent;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .agent-response:hover {
      transform: translateX(8px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      border-left-color: #667eea;
    }

    .agent-response-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .agent-response-content {
      flex: 1;
    }

    .agent-response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .agent-response-name {
      font-size: 16px;
      font-weight: 600;
      color: #1a1a2e;
    }

    .agent-stance {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .stance-support {
      background: #d1fae5;
      color: #065f46;
    }

    .stance-oppose {
      background: #fee2e2;
      color: #991b1b;
    }

    .stance-neutral {
      background: #fef3c7;
      color: #92400e;
    }

    .agent-response-text {
      font-size: 15px;
      line-height: 1.7;
      color: #374151;
      margin-top: 8px;
    }

    .synthesis-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 32px;
      border-radius: 16px;
      margin-top: 32px;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      animation: fadeIn 0.5s ease;
    }

    .synthesis-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
    }

    .synthesis-icon {
      font-size: 48px;
    }

    .synthesis-title {
      font-size: 24px;
      font-weight: 700;
    }

    .synthesis-content {
      font-size: 15px;
      line-height: 1.8;
      opacity: 0.95;
      white-space: pre-wrap;
    }

    .verdict-box {
      background: rgba(255, 255, 255, 0.2);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      border-left: 4px solid white;
    }

    .verdict-label {
      font-size: 14px;
      font-weight: 600;
      opacity: 0.9;
      margin-bottom: 8px;
    }

    .verdict-text {
      font-size: 18px;
      font-weight: 700;
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin: 32px 0;
    }

    .metric-card {
      background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
      padding: 24px;
      border-radius: 12px;
      text-align: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .metric-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .metric-card.success {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    }

    .metric-value {
      font-size: 36px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }

    .metric-label {
      font-size: 13px;
      color: #6b7280;
      font-weight: 600;
    }

    .right-sidebar {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 28px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      animation: fadeInUp 0.5s ease;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 6px;
    }

    .card-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 20px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 14px;
      color: #6b7280;
      text-align: center;
    }

    .error-message {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      color: #991b1b;
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      font-weight: 500;
    }

    @media (max-width: 1200px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const API_BASE_URL = 'http://localhost:8005/api';

    function AgentCard({ agent, isActive, isSpeaking }) {
      return (
        <div className={`agent-card ${isActive ? 'active' : ''} ${isSpeaking ? 'speaking' : ''}`}>
          <div className="agent-icon">{agent.icon}</div>
          <div className="agent-info">
            <h3>{agent.name}</h3>
            <p>{agent.role}</p>
            {isSpeaking && <span className="agent-status">Speaking...</span>}
          </div>
        </div>
      );
    }

    function MetricCard({ value, label, isSuccess }) {
      return (
        <div className={`metric-card ${isSuccess ? 'success' : ''}`}>
          <div className="metric-value">{value}</div>
          <div className="metric-label">{label}</div>
        </div>
      );
    }

    function AgentResponseCard({ response, agent }) {
      return (
        <div className="agent-response">
          <div className="agent-response-icon">{agent ? agent.icon : 'ü§ñ'}</div>
          <div className="agent-response-content">
            <div className="agent-response-header">
              <div>
                <span className="agent-response-name">{response.agent}</span>
                {agent && (
                  <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '2px' }}>
                    {agent.role}
                  </div>
                )}
              </div>
              <span className={`agent-stance stance-${response.stance.toLowerCase()}`}>
                {response.stance}
              </span>
            </div>
            <div className="agent-response-text">{response.response}</div>
          </div>
        </div>
      );
    }

    function RoundSection({ roundNum, responses, agents }) {
      return (
        <div className="round-section">
          <div className="round-header">
            <div className="round-number">{roundNum}</div>
            <div className="round-title">Round {roundNum}</div>
          </div>
          {responses.map((response, idx) => {
            const agent = agents.find(a => a.name === response.agent);
            return <AgentResponseCard key={idx} response={response} agent={agent} />;
          })}
        </div>
      );
    }

    function App() {
      const [agents, setAgents] = useState([]);
      const [loading, setLoading] = useState(true);
      const [debating, setDebating] = useState(false);
      const [debateComplete, setDebateComplete] = useState(false);
      const [topic, setTopic] = useState('Should we raise prices by 30% to improve margins?');
      const [rounds, setRounds] = useState([]);
      const [synthesis, setSynthesis] = useState(null);
      const [currentRound, setCurrentRound] = useState(0);
      const [currentAgent, setCurrentAgent] = useState(null);
      const [error, setError] = useState(null);
      const [metrics, setMetrics] = useState({
        rounds: 0,
        totalResponses: 0,
        duration: 0
      });
      const eventSourceRef = useRef(null);
      const startTimeRef = useRef(null);
      const durationIntervalRef = useRef(null);

      useEffect(() => {
        loadAgents();
      }, []);

      async function loadAgents() {
        try {
          const response = await fetch(`${API_BASE_URL}/agents`);
          const data = await response.json();
          console.log('Loaded agents:', data);
          setAgents(data.agents || []);
          setLoading(false);
        } catch (err) {
          console.error('Error loading agents:', err);
          setError('Failed to connect to API. Please ensure your server is running on port 8005.');
          setLoading(false);
        }
      }

      function downloadDebate() {
        const debateData = {
          topic: topic,
          rounds: rounds,
          synthesis: synthesis,
          metrics: metrics,
          timestamp: new Date().toISOString()
        };

        const blob = new Blob([JSON.stringify(debateData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `debate-${Date.now()}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      async function startDebate() {
        if (!topic.trim()) {
          setError('Please enter a debate topic');
          return;
        }

        setDebating(true);
        setDebateComplete(false);
        setRounds([]);
        setSynthesis(null);
        setError(null);
        setCurrentRound(0);
        setCurrentAgent(null);
        startTimeRef.current = Date.now();

        durationIntervalRef.current = setInterval(() => {
          const duration = Math.floor((Date.now() - startTimeRef.current) / 1000);
          setMetrics(prev => ({ ...prev, duration }));
        }, 1000);

        try {
          const response = await fetch(`${API_BASE_URL}/debate/stream`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              topic: topic,
              rounds: 3
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const reader = response.body.getReader();
          const decoder = new TextDecoder('utf-8', { fatal: false });
          let tempRounds = [[], [], []];
          let totalResponses = 0;
          let buffer = '';

          const processLine = (line) => {
            if (!line.trim() || !line.startsWith('data: ')) return;
            
            const jsonStr = line.substring(6).trim();
            if (!jsonStr || jsonStr === '[DONE]') return;
            
            try {
              const data = JSON.parse(jsonStr);
              console.log('Stream event:', data);

              switch (data.type) {
                case 'start':
                  console.log('Debate started');
                  break;

                case 'round_start':
                  setCurrentRound(data.round);
                  break;

                case 'agent_start':
                  setCurrentAgent(data.agent);
                  break;

                case 'agent_response':
                  const agentResponse = data.data;
                  console.log('Agent response received:', {
                    agent: agentResponse.agent,
                    round: agentResponse.round,
                    stance: agentResponse.stance,
                    responseLength: agentResponse.response?.length
                  });
                  tempRounds[agentResponse.round - 1].push(agentResponse);
                  setRounds([...tempRounds]);
                  totalResponses++;
                  setMetrics(prev => ({
                    ...prev,
                    totalResponses: totalResponses,
                    rounds: agentResponse.round
                  }));
                  setCurrentAgent(null);
                  break;

                case 'round_complete':
                  console.log(`Round ${data.round} complete`);
                  break;

                case 'synthesis_start':
                  setCurrentAgent('Synthesizer');
                  break;

                case 'synthesis':
                  setSynthesis(data.data);
                  setCurrentAgent(null);
                  break;

                case 'complete':
                  console.log('Debate complete');
                  setDebateComplete(true);
                  setDebating(false);
                  setCurrentAgent(null);
                  clearInterval(durationIntervalRef.current);
                  break;

                case 'cancelled':
                  console.log('Debate cancelled');
                  setDebating(false);
                  setCurrentAgent(null);
                  clearInterval(durationIntervalRef.current);
                  break;
              }
            } catch (e) {
              console.warn('Failed to parse SSE data:', e.message);
            }
          };

          while (true) {
            const { done, value } = await reader.read();
            
            if (done) {
              console.log('Stream complete');
              // Process any remaining buffer
              if (buffer.trim()) {
                processLine(buffer);
              }
              setDebateComplete(true);
              setDebating(false);
              setCurrentAgent(null);
              clearInterval(durationIntervalRef.current);
              break;
            }

            // Decode chunk with non-fatal error handling
            const chunk = decoder.decode(value, { stream: true });
            buffer += chunk;

            // Split on double newlines (SSE message boundary) or single newlines
            const lines = buffer.split(/\r?\n/);
            
            // Keep last incomplete line in buffer
            buffer = lines.pop() || '';

            // Process complete lines
            lines.forEach(processLine);
          }
        } catch (err) {
          console.error('Debate error:', err);
          clearInterval(durationIntervalRef.current);
          setError(`Debate failed: ${err.message}`);
          setDebating(false);
          setCurrentAgent(null);
        }
      }

      async function stopDebate() {
        try {
          await fetch(`${API_BASE_URL}/debate/stop`, { method: 'POST' });
          if (eventSourceRef.current) {
            eventSourceRef.current.close();
          }
          clearInterval(durationIntervalRef.current);
          setDebating(false);
          setCurrentAgent(null);
        } catch (err) {
          console.error('Error stopping debate:', err);
        }
      }

      if (loading) {
        return (
          <div className="app">
            <div className="loading-container" style={{ width: '100%' }}>
              <div className="spinner"></div>
              <p>Loading Strategic Council...</p>
            </div>
          </div>
        );
      }

      const progress = debateComplete ? 100 : currentRound > 0 ? (currentRound / 3) * 100 : 0;

      return (
        <div className="app">
          <aside className="sidebar">
            <div className="sidebar-header">
              <h1>Strategic Council</h1>
              <p>{agents.length} Specialized Agents</p>
            </div>
            <div className="agents-container">
              {agents.length > 0 ? (
                agents.map((agent, index) => (
                  <AgentCard
                    key={index}
                    agent={agent}
                    isActive={currentAgent === agent.name}
                    isSpeaking={debating && currentAgent === agent.name}
                  />
                ))
              ) : (
                <div className="error-message">
                  No agents loaded. Check console for errors.
                </div>
              )}
            </div>
          </aside>

          <main className="main-content">
            <header className="header">
              <div className="header-content">
                <span className="breadcrumb">Multi-Agent Debate System</span>
                <div className="action-buttons">
                  {!debating && !debateComplete && (
                    <button 
                      className="btn btn-primary" 
                      onClick={startDebate}
                      disabled={agents.length === 0}
                    >
                      üéØ Start Debate
                    </button>
                  )}
                  {debating && (
                    <button 
                      className="btn btn-danger" 
                      onClick={stopDebate}
                    >
                      ‚èπÔ∏è Stop Debate
                    </button>
                  )}
                  {debateComplete && (
                    <>
                      <button 
                        className="btn btn-success"
                        onClick={downloadDebate}
                      >
                        üì• Download Debate
                      </button>
                      <button 
                        className="btn btn-secondary"
                        onClick={() => {
                          setRounds([]);
                          setSynthesis(null);
                          setDebateComplete(false);
                          setMetrics({ rounds: 0, totalResponses: 0, duration: 0 });
                        }}
                      >
                        üîÑ New Debate
                      </button>
                    </>
                  )}
                </div>
              </div>
              <div className="topic-input-container">
                <input
                  type="text"
                  className="topic-input"
                  placeholder="Enter debate topic..."
                  value={topic}
                  onChange={(e) => setTopic(e.target.value)}
                  disabled={debating}
                />
              </div>
            </header>

            <div className="content-grid">
              <div className="debate-section">
                <h2 className="debate-title">{topic}</h2>
                <p className="debate-subtitle">
                  {debating && <span className="status-indicator"></span>}
                  {debating ? 'üî¥ Live debate in progress - 3 rounds' : 
                   debateComplete ? '‚úÖ Debate completed with synthesis' : 
                   '‚è∏Ô∏è Ready to start multi-agent debate'}
                </p>

                {error && <div className="error-message">{error}</div>}

                {rounds.length > 0 && (
                  <div className="rounds-container">
                    {rounds.map((roundResponses, idx) => (
                      roundResponses.length > 0 && (
                        <RoundSection
                          key={idx}
                          roundNum={idx + 1}
                          responses={roundResponses}
                          agents={agents}
                        />
                      )
                    ))}
                  </div>
                )}

                {synthesis && (
                  <div className="synthesis-section">
                    <div className="synthesis-header">
                      <span className="synthesis-icon">üîÆ</span>
                      <div>
                        <div className="synthesis-title">Synthesizer's Final Verdict</div>
                        <div style={{ fontSize: '14px', opacity: 0.9 }}>
                          Comprehensive analysis and recommendation
                        </div>
                      </div>
                    </div>
                    <div className="synthesis-content">{synthesis.synthesis}</div>
                    <div className="verdict-box">
                      <div className="verdict-label">FINAL VERDICT</div>
                      <div className="verdict-text">{synthesis.verdict}</div>
                    </div>
                  </div>
                )}

                {!debating && !debateComplete && rounds.length === 0 && (
                  <div className="loading-container">
                    <p>üí° Enter your debate topic above and click "Start Debate"</p>
                    <p style={{ fontSize: '14px', color: '#6b7280', marginTop: '12px' }}>
                      The council will debate for 3 rounds, with each agent providing their perspective in real-time
                    </p>
                  </div>
                )}

                <div className="metrics-grid">
                  <MetricCard value={metrics.rounds} label="Debate Rounds" />
                  <MetricCard value={metrics.totalResponses} label="Agent Responses" />
                  <MetricCard value={`${metrics.duration}s`} label="Duration" />
                  <MetricCard 
                    value={debateComplete ? '‚úì' : debating ? '‚è≥' : '‚è∏Ô∏è'} 
                    label={debateComplete ? 'Complete' : debating ? 'In Progress' : 'Pending'}
                    isSuccess={debateComplete}
                  />
                </div>
              </div>

              <aside className="right-sidebar">
                <div className="card">
                  <h3 className="card-title">Debate Progress</h3>
                  <p className="card-subtitle">Real-time status</p>
                  <div className="progress-bar">
                    <div 
                      className="progress-fill" 
                      style={{ width: `${progress}%` }}
                    ></div>
                  </div>
                  <p className="progress-text">
                    {debateComplete ? 'Debate Complete ‚úì' : 
                     debating ? `Round ${currentRound}/3 - ${currentAgent || 'Processing...'}` : 
                     'Waiting to start'}
                  </p>
                </div>

                <div className="card">
                  <h3 className="card-title">How It Works</h3>
                  <p className="card-subtitle">Multi-agent debate process</p>
                  <ul style={{ listStyle: 'none', padding: 0 }}>
                    <li style={{ marginBottom: '12px', paddingLeft: '24px', position: 'relative' }}>
                      <span style={{ position: 'absolute', left: 0, color: '#667eea', fontWeight: 700 }}>1.</span>
                      <strong>Round 1:</strong> Each agent presents initial perspective
                    </li>
                    <li style={{ marginBottom: '12px', paddingLeft: '24px', position: 'relative' }}>
                      <span style={{ position: 'absolute', left: 0, color: '#667eea', fontWeight: 700 }}>2.</span>
                      <strong>Round 2:</strong> Agents respond to others' arguments
                    </li>
                    <li style={{ marginBottom: '12px', paddingLeft: '24px', position: 'relative' }}>
                      <span style={{ position: 'absolute', left: 0, color: '#667eea', fontWeight: 700 }}>3.</span>
                      <strong>Round 3:</strong> Final positions and conclusions
                    </li>
                    <li style={{ marginBottom: '12px', paddingLeft: '24px', position: 'relative' }}>
                      <span style={{ position: 'absolute', left: 0, color: '#667eea', fontWeight: 700 }}>4.</span>
                      <strong>Synthesis:</strong> Synthesizer provides final verdict
                    </li>
                  </ul>
                </div>

                <div className="card">
                  <h3 className="card-title">Active Agents</h3>
                  <p className="card-subtitle">Participating in debate</p>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                    {agents.filter(a => a.name !== 'Synthesizer').map((agent, idx) => (
                      <span 
                        key={idx}
                        style={{
                          padding: '8px 12px',
                          background: currentAgent === agent.name ? '#10b981' : '#f3f4f6',
                          color: currentAgent === agent.name ? 'white' : '#374151',
                          borderRadius: '8px',
                          fontSize: '13px',
                          fontWeight: 600,
                          transition: 'all 0.3s'
                        }}
                      >
                        {agent.icon} {agent.name}
                      </span>
                    ))}
                  </div>
                </div>
              </aside>
            </div>
          </main>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>

